version: '3.4'

services:
  # frontend:
  #   env_file: ./.env
  #   build: 
  #     context: ./frontend
  #     args:
  #       - REACT_APP_API_BASE_URL=$CLIENT_API_BASE_URL
  #     dockerfile: Dockerfile
  #     target: dev
  #   restart: unless-stopped
  #   environment:
  #     - CHOKIDAR_USEPOLLING=true
  #   volumes: 
  #       - ./frontend:/app/frontend
  #   image: fronted:v1.0.0
  #   ports:
  #     - $REACT_PORT:$REACT_DOCKER_PORT
    
  #   networks:
  #     - app-network
  #   depends_on:
  #     - api
  redis:
    image: 'redis'
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    ports:
      - '6379:6379'
    volumes:
      - ./redis/conf:/usr/local/etc/redis
    networks:
      - app-network 
 

  nginx_proxy:
    env_file: ./.env
    restart: always
    build:
      context: ./nginx
      dockerfile: Dockerfile
    image: proxy:v1.0.0
    container_name: nginx_proxy
    volumes:
      - ./nginx/default.conf:/etc/nginx/conf.d/default.conf
    networks:
      - app-network
    ports:
      - $NODE_LOCAL_PORT:$NODE_DOCKER_NGINX_PORT
   
  
     
  api:
    env_file: ./.env
    environment:
    -  NODE_ENV=$NODE_ENV
    -  PORT=$PORT
    -  MONGO_URL=$MONGO_URL
    -  JWT_TOKEN_SECRET=$JWT_TOKEN_SECRET
    -  PAYPAL_CLIENT_ID=$PAYPAL_CLIENT_ID
    -  REDIS_SERVER_IP=redis
    -  REDIS_PORT=6379
    build:
      context: ./backend
      dockerfile: Dockerfile
    image: api:v1.0.0
    container_name: api
    restart: unless-stopped
    volumes:
    - ./backend:/app/backend
    networks:
      - app-network

networks:
  app-network:
     driver: bridge

 
      
  

